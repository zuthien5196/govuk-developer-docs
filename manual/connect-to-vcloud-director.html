


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Connect to vCloud Director (Carrenza only) - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/connect-to-vcloud-director.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Connect to vCloud Director (Carrenza only)" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/connect-to-vcloud-director.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Connect to vCloud Director (Carrenza only) - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/connect-to-vcloud-director.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Connect to vCloud Director (Carrenza only)</span></a>
    <ul>
      <li>
        <a href="#setting-up-the-cisco-anyconnect-vpn-profile-on-a-mac"><span>Setting up the Cisco AnyConnect VPN profile on a Mac</span></a>
      </li>
      <li>
        <a href="#connecting-with-openconnect"><span>Connecting with OpenConnect</span></a>
      </li>
      <li>
        <a href="#accessing-vcloud-director"><span>Accessing vCloud Director</span></a>
      </li>
      <li>
        <a href="#backup-vpn-account"><span>Backup VPN account</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#infrastructure'>Infrastructure</a></p> <h1 id='header'>Connect to vCloud Director (Carrenza only)</h1><p>vCloud Director is the interface we use to manage our infrastructure in
Carrenza. This includes virtual machines, gateways, firewalls and VPNs between
providers.</p>
<p>To access vCloud Director, you will need to connect to a Carrenza-provided VPN.
You can use either Cisco AnyConnect or OpenConnect as a VPN client for this.</p>
<p><strong>Please ensure VPN certificates are renewed via Carrenza service portal before expiry:</strong></p>

<ol>
<li>Expiry date of primary Carrenza VPN certificate is May 27 16:29:58 2021 GMT</li>
<li>Expiry date of backup Carrenza VPN certificate is Jun  4 12:14:47 2021 GMT</li>
</ol>
<h2 id='setting-up-the-cisco-anyconnect-vpn-profile-on-a-mac'>Setting up the Cisco AnyConnect VPN profile on a Mac</h2>
<ol>
<li><p>Make sure you have the latest version of <a href="https://github.com/alphagov/govuk-secrets">govuk-secrets</a>.</p></li>
<li><p>Install <code>oathtool</code> (this will be used to generate one time passwords).</p></li>
</ol>
<div class="highlight"><pre class="highlight shell"><code>   <span class="nv">$ </span>brew <span class="nb">install </span>oath-toolkit
</code></pre></div>
<ol>
<li><p>Get the VPN client certificate and private key from the 2nd line
<a href="https://github.com/alphagov/govuk-secrets/tree/master/pass">password store</a>
and save the decrypted contents to a file on your machine (for example
 <code>~/carrenza-vpn-cert-and-key.pem</code>).</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ PASSWORD_STORE_DIR</span><span class="o">=</span>~/govuk/govuk-secrets/pass/2ndline pass carrenza/vpn-certificate <span class="o">&gt;</span> ~/carrenza-vpn-cert-and-key.pem
</code></pre></div></li>
<li><p>Get the VPN credentials, also from the 2nd line password store.</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ PASSWORD_STORE_DIR</span><span class="o">=</span>~/govuk/govuk-secrets/pass/2ndline pass carrenza/vpn-credentials
Certificate passphrase: ...
MFA key: ................
Password: ...
VPN gateway: ...
</code></pre></div></li>
<li><p>Convert the VPN client certificate from PEM format to PFX format. You will
be asked for two passwords (one for decrypting the PEM and one for
encrypting the PFX). The first password is the <code>Certificate passphrase</code>
field from <code>carrenza/vpn-credentials</code>. The second password can be of your
own choice. You will need it for the next few steps but you won&rsquo;t need to
remember it after that.</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>openssl pkcs12 <span class="nt">-export</span> <span class="nt">-in</span> ~/carrenza-vpn-cert-and-key.pem <span class="nt">-out</span> ~/carrenza-vpn-cert-and-key.pfx
Enter pass phrase <span class="k">for</span> /Users/.../carrenza-vpn-cert-and-key.pem: &lt;Certificate passphrase from vpn-credentials&gt;
Enter Export Password: &lt;Password from vpn-credentials&gt;
Verifying - Enter Export Password:
</code></pre></div></li>
<li><p>Import the PFX format certificate into your macOS login keychain. You&rsquo;ll be
asked for a password. Enter the passphrase which you used to encrypt the PFX
file (<code>Certificate passphrase</code> field from <code>carrenza/vpn-credentials</code>).</p></li>
</ol>
<div class="highlight"><pre class="highlight shell"><code>   <span class="nv">$ </span>security import ~/carrenza-vpn-cert-and-key.pfx
</code></pre></div><p>This allows you to use Cisco AnyConnect as VPN client.</p>

<ol>
<li><p>Delete the PFX file as it is no longer needed.</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span><span class="nb">rm</span> ~/carrenza-vpn-cert-and-key.pfx
</code></pre></div></li>
</ol>
<h2 id='connecting-with-openconnect'>Connecting with OpenConnect</h2><p><strong>Make sure to read these instructions carefully before login on Carrenza VPN.
If you enter the wrong credentials too many times, we will be locked out!</strong></p>

<ol>
<li>Install OpenConnect: <code>brew install openconnect</code></li>
<li>Run OpenConnect. Make sure you provide the correct path to where
you&rsquo;ve saved the VPN client certificate.</li>
</ol>
<div class="highlight"><pre class="highlight shell"><code>   <span class="nv">$ </span><span class="nb">sudo </span>openconnect https://secure.carrenza.com <span class="nt">-c</span> ~/carrenza-vpn-cert-and-key.pem
</code></pre></div>
<ol>
<li>The first password is your machine password (requested by sudo).</li>
<li>The second password (the PEM passphrase) is the certificate passphrase from
the password store.</li>
<li>The third password is the 2FA code (use <code>oathtool -b
&lt;MFA-key-from-password-store&gt; --totp</code>).</li>
<li>The fourth password is the password from the password store.</li>
</ol>
<h2 id='accessing-vcloud-director'>Accessing vCloud Director</h2>
<ol>
<li><p>Fetch the VCloud Director credentials for the environment which you want to
connect to.</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ PASSWORD_STORE_DIR</span><span class="o">=</span>~/govuk/govuk-secrets/pass/2ndline pass carrenza/vcloud-integration
......... &lt;a long string which is the VCloud Director password&gt;
User: &lt;username <span class="k">for </span>logging into VCloud Director&gt;
Org: &lt;this string goes <span class="k">in </span>the URL path <span class="k">for </span>accessing VCloud Director&gt;
</code></pre></div></li>
<li><p>Ensure that you are connected to the Carrenza VPN (see above).</p></li>
<li><p>Visit https://vcloud.carrenza.com/tenant/{organisation}/ (replacing
{organisation} with the value of the <code>Org</code> field from the password store
entry.</p></li>
<li><p>Log in with the username and password from the password store entry.</p></li>
</ol>
<h2 id='backup-vpn-account'>Backup VPN account</h2><p>There is a backup VPN account to be used primarily by reliability engineers.</p>
<p>The VPN certificate can be obtained from the infra pass, e.g.
<code>sh
PASSWORD_STORE_DIR=~/govuk/govuk-secrets/pass/infra pass carrenza/vpn-backup-certificate
</code></p>
<p>The VPN credentials can be obtained from the infra pass, e.g.
<code>sh
PASSWORD_STORE_DIR=~/govuk/govuk-secrets/pass/infra pass carrenza/vpn-backup-credentials
</code></p>
<p>You should not import the certificate into your macOS login keychain because this
can cause confusion for the Cisco AnyConnect VPN client. The certificate will
work with OpenConnect VPN client without importing in your macOS keychain.</p>
<p>The rest of the instructions remain the same as for the primary VPN account.</p>


  <div class='related-content'>

    <h3>More in the Infrastructure section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/govuk-app-domain-handling-during-migration.html">app_domain handling in GOV.UK during migration to AWS</a></li>
            <li><a href="/manual/concourse.html">Concourse</a></li>
            <li><a href="/manual/dns.html">Domain Name System (DNS) records</a></li>
            <li><a href="/manual/vpn.html">GOV.UK and Virtual Private Networks (VPNs)</a></li>
            <li><a href="/manual/environments.html">GOV.UK's environments (integration, staging, production)</a></li>
            <li><a href="/manual/load-testing.html">Load Testing</a></li>
            <li><a href="/manual/upgrade-terraform.html">Upgrade Terraform</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/adding-disks-in-vcloud.html">Add a disk to a vCloud machine (Carrenza only)</a></li>
            <li><a href="/manual/ruby.html">Add a new Ruby version</a></li>
            <li><a href="/manual/generate-csr.html">Generate a Certificate Signing Request (CSR) for GOV.UK</a></li>
            <li><a href="/manual/rabbitmq.html">Manage RabbitMQ</a></li>
            <li><a href="/manual/auto-scaling-groups.html">Manually resize ASGs (auto scaling groups)</a></li>
            <li><a href="/manual/move-apps-between-servers.html">Move apps between servers</a></li>
            <li><a href="/manual/patching-jenkins.html">Patch Jenkins</a></li>
            <li><a href="/manual/provision-machines-for-data-science-research.html">Provision machines for data science research</a></li>
            <li><a href="/manual/alerts/rebooting-machines.html">Reboot a machine</a></li>
            <li><a href="/manual/remove-machines.html">Remove a machine</a></li>
            <li><a href="/manual/renew-a-tls-certificate.html">Renew a TLS certificate for GOV.UK</a></li>
            <li><a href="/manual/reprovision.html">Reprovision a machine</a></li>
          </ul>
        </div>

    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2020-11-15">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 15 May 2020.

        It needs to be reviewed again on 15 November 2020
        by the page owner <a href="">#re-govuk</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 15 November 2020
       by the page owner <a href="">#re-govuk</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/connect-to-vcloud-director.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Connect%20to%20vCloud%20Director%20(Carrenza%20only)'&amp;body=Problem%20with%20'Connect%20to%20vCloud%20Director%20(Carrenza%20only)'%20(https://docs.publishing.service.gov.uk/manual/connect-to-vcloud-director.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
