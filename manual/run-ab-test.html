


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Run an A/B or multivariate test - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/run-ab-test.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Run an A/B or multivariate test" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/run-ab-test.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Run an A/B or multivariate test - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/run-ab-test.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Run an A/B or multivariate test</span></a>
    <ul>
      <li>
        <a href="#1-preparation"><span>1. Preparation</span></a>
        <ul>
          <li>
            <a href="#choose-your-test-name"><span>Choose your test name</span></a>
          </li>
          <li>
            <a href="#consider-load"><span>Consider load</span></a>
          </li>
          <li>
            <a href="#decide-how-the-variants-should-be-split"><span>Decide how the variants should be split</span></a>
          </li>
          <li>
            <a href="#choose-your-cookie-expiry"><span>Choose your cookie expiry</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#2-how-to-set-up-an-ab-test"><span>2. How to set up an A/B test</span></a>
      </li>
      <li>
        <a href="#3-how-to-remove-your-ab-test"><span>3. How to remove your A/B test</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#ab-testing'>A/B testing</a></p> <h1 id='header'>Run an A/B or multivariate test</h1><h2 id='1-preparation'>1. Preparation</h2><h3 id='choose-your-test-name'>Choose your test name</h3><p>The name should begin with <code>ABTest-</code>.  Try to keep it short.</p>
<p>You don&rsquo;t need to use the <code>ABTest-</code> prefix
in <a href="https://github.com/alphagov/collections/blob/54dd7d22567ec932a16c262387ae609e9cc47aae/app/controllers/concerns/taxon_pages_testable.rb#L25">your code</a>
though as <a href="https://github.com/alphagov/govuk-cdn-config/blob/955dd25e6443a8fd7142cebdb60d7bee43a067b7/vcl_templates/www.vcl.erb#L348">it&rsquo;s already configured in Fastly</a>.</p>
<h3 id='consider-load'>Consider load</h3><p>You will need to take steps to ensure that GOV.UK can cope with the extra load
on origin generated by an AB test.  Extra load occurs because <a href="https://github.com/alphagov/govuk_ab_testing/blob/8284cb2b2e7d504e412bd9184ddd43f874dd9b7c/lib/govuk_ab_testing/requested_variant.rb#L59">AB tests add <code>Vary</code> headers</a>
to responses. If you add AB testing headers to all content, then requests for any
content will tend to miss the cache more often.  This adds load to origin servers.</p>
<p>You can minimise the impact of this by configuring your test to only return AB
testing headers on pages that you are measuring.
<a href="https://github.com/alphagov/government-frontend/blob/9ba288dd809a2246ec349c708f693ba306c69e7e/app/controllers/concerns/guide_nav_ab_testable.rb#L36">Example testing navigation on mainstream guides</a>.</p>
<p>You may want to deploy your test at a quieter time of day (such as 9:30am) rather
than the middle of the day.  This allows CDN caches to warm up in a slightly more
graceful way.  Check when a quiet time for your test case is.</p>
<p>Make sure you monitor your test for some time after deployment to ensure that
everything is working OK.</p>
<h3 id='decide-how-the-variants-should-be-split'>Decide how the variants should be split</h3><p><strong>Bear in mind that users who have not opted in to analytics cookies will not be assigned to a variant by Fastly and will not have a cookie set.</strong></p>
<p>A higher percentage on your B variant will reduce the time that you need to run
the test.  Your performance analyst can help here.</p>
<p>You may want to start with a small B percentage and ramp up gradually, either for
load reasons, or if there&rsquo;s something a bit controversial in your test that may
perform particularly poorly with users.</p>
<h3 id='choose-your-cookie-expiry'>Choose your cookie expiry</h3><p>The cookie expiry time should be short until you have established traffic across
the desired split between your variants.</p>
<p>Once your variants are at the desired proportions, the cookie expiry time should
be longer than the expected test duration.  This ensures that users are kept in
the same variant for the duration of the test which allows them to get used to
whatever changes you have made.</p>
<p>It&rsquo;s good to have a margin for error, to (for example) correct faulty tracking
at the start, or perhaps run the test for a few more days at the end if you
need more data.</p>
<h2 id='2-how-to-set-up-an-ab-test'>2. How to set up an A/B test</h2>
<ol>
<li>Add your test to the <a href="https://docs.google.com/spreadsheets/d/1voQzdoGAFO9Tnvl7Xq4ahLEAyGtkeAtvTC26SxEP6rE/edit">A/B test register</a>.</li>
<li>If you want to use Google Analytics to monitor the A/B test, talk to a performance analyst and pick a <a href="https://gov-uk.atlassian.net/wiki/display/GOVUK/Analytics+on+GOV.UK">GA dimension</a> to use for your test.</li>
<li>Create dictionary and A/B test files in <a href="https://github.com/alphagov/govuk-cdn-config">the govuk-cdn-config repo</a>. See an <a href="https://github.com/alphagov/govuk-cdn-config-secrets/commit/ba3ec923c0bb5bdf17bdaf02419ff4e049516fda">example for the dictionaries</a> and an <a href="https://github.com/alphagov/fastly-configure/pull/29/files">example for the A/B configuration</a> (these used to be in a different repo). For more details, see the <a href="https://github.com/alphagov/govuk-cdn-config#fastly-dictionaries">dictionaries README</a>.</li>
<li>Deploy the dictionary changes to each environment using the <a href="https://deploy.staging.publishing.service.gov.uk/job/Update_CDN_Dictionaries/">Update_CDN_Dictionaries</a> Jenkins job. The API key is in the <a href="https://github.com/alphagov/govuk-secrets/blob/master/pass/2ndline/fastly/2nd_line_api_token.gpg">govuk-secrets repo</a> and the dictionaries must be deployed to the <code>www</code> vhost.</li>
<li>Deploy the Fastly configuration to each environment using the <a href="https://deploy.staging.publishing.service.gov.uk/job/Deploy_CDN/">Deploy_CDN</a> Jenkins job. Use the same parameters as in step 4. You can test it on staging by visiting <a href="https://www.staging.publishing.service.gov.uk">https://www.staging.publishing.service.gov.uk</a>. Changes should appear almost immediately - there is no caching of the CDN config.</li>
<li>Use the <a href="https://github.com/alphagov/govuk_ab_testing">govuk_ab_testing gem</a> to serve different versions to your users. It can be configured with the analytics dimension selected in step 2.</li>
<li>To activate or deactivate the test, or to change the B percentage, update your test in <a href="https://github.com/alphagov/govuk-cdn-config">the govuk-cdn-config repo</a> and deploy the dictionaries.</li>
</ol>
<p>If you&rsquo;re making a change to Search API, you may also want to test using
the <a href="https://github.com/alphagov/search-performance-explorer/">search performance explorer</a>.
In which case, you&rsquo;ll need to <a href="https://github.com/alphagov/search-performance-explorer/commit/01e3d21ceca96951425b5ddc87116f0756411691">add your AB test</a> to the application, and manually
deploy it to Heroku.</p>
<h2 id='3-how-to-remove-your-ab-test'>3. How to remove your A/B test</h2><p>Follow these steps:</p>

<ol>
<li>Remove your test from the <a href="https://github.com/alphagov/govuk-cdn-config/blob/master/ab_tests/ab_tests.yaml">ab_tests configuration file</a> in the <a href="https://github.com/alphagov/govuk-cdn-config">govuk-cdn-config</a> repo and remove the dictionary files.</li>
<li>Deploy the Fastly configuration to each environment using the <a href="https://deploy.staging.publishing.service.gov.uk/job/Deploy_CDN/">Deploy_CDN</a> Jenkins job. The <code>vhost</code> must be set to <code>www</code>, and the credentials are in the govuk-secrets repo.</li>
<li>Deploy the govuk-cdn-config changes to each environment using the <a href="https://deploy.staging.publishing.service.gov.uk/job/Update_CDN_Dictionaries/">Update_CDN_Dictionaries</a> Jenkins job. Use the same parameters as in step 2.</li>
<li>Mark the end date in <a href="https://docs.google.com/spreadsheets/d/1voQzdoGAFO9Tnvl7Xq4ahLEAyGtkeAtvTC26SxEP6rE/edit">A/B test register</a>.</li>
</ol>


  <div class='related-content'>

    <h3>More in the A/B testing section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/ab-testing.html">How A/B testing works</a></li>
          </ul>
        </div>


    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2020-08-07">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 7 February 2020.

        It needs to be reviewed again on 7 August 2020
        by the page owner <a href="">#govuk-developers</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 7 August 2020
       by the page owner <a href="">#govuk-developers</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/run-ab-test.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Run%20an%20A/B%20or%20multivariate%20test'&amp;body=Problem%20with%20'Run%20an%20A/B%20or%20multivariate%20test'%20(https://docs.publishing.service.gov.uk/manual/run-ab-test.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
