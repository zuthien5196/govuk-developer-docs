


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Conventions for Rails applications - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/conventions-for-rails-applications.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Conventions for Rails applications" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/conventions-for-rails-applications.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Conventions for Rails applications - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/conventions-for-rails-applications.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Conventions for Rails applications</span></a>
    <ul>
      <li>
        <a href="#our-approach"><span>Our approach</span></a>
      </li>
      <li>
        <a href="#tooling-choices"><span>Tooling choices</span></a>
        <ul>
          <li>
            <a href="#use-gov-uk-supporting-gems"><span>Use GOV.UK supporting Gems</span></a>
          </li>
          <li>
            <a href="#data-storage"><span>Data storage</span></a>
          </li>
          <li>
            <a href="#background-job-processing"><span>Background job processing</span></a>
          </li>
          <li>
            <a href="#javascript-package-management"><span>JavaScript package management</span></a>
          </li>
          <li>
            <a href="#frontend-assets"><span>Frontend assets</span></a>
          </li>
          <li>
            <a href="#sending-emails"><span>Sending emails</span></a>
          </li>
          <li>
            <a href="#testing-utilities"><span>Testing utilities</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#configuration"><span>Configuration</span></a>
        <ul>
          <li>
            <a href="#embrace-12-factor-conventions"><span>Embrace 12 factor conventions</span></a>
          </li>
          <li>
            <a href="#inject-secrets-with-environment-variables"><span>Inject secrets with environment variables</span></a>
          </li>
          <li>
            <a href="#use-api_only-mode-for-api-projects"><span>Use api_only mode for API projects</span></a>
          </li>
          <li>
            <a href="#editing-of-microcopy-by-non-developers"><span>Editing of microcopy by non-developers</span></a>
          </li>
          <li>
            <a href="#error-handling"><span>Error handling</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#organising-your-code"><span>Organising your code</span></a>
      </li>
      <li>
        <a href="#documenting-your-decisions"><span>Documenting your decisions</span></a>
      </li>
      <li>
        <a href="#testing-strategies"><span>Testing strategies</span></a>
        <ul>
          <li>
            <a href="#featuresystem-testing"><span>Feature/system testing</span></a>
          </li>
          <li>
            <a href="#testing-controllers"><span>Testing controllers</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#applications'>Applications</a></p> <h1 id='header'>Conventions for Rails applications</h1><p>The majority of GOV.UK applications are built using <a href="https://rubyonrails.org/">Ruby on Rails</a> and over
the years we have created a lot them. Along the way we&rsquo;ve used a variety of
patterns and conventions. We aim for GOV.UK apps to be <a href="https://docs.google.com/document/d/1jEjPOFJ2s1cjQv9vHAbE-KF68LSletpnUVaG5lXlHy4/edit#heading=h.yod40rauhyhu">consistent in their
implementation</a> with differences in domain logic. However,
it isn&rsquo;t practical to evolve all apps at the same pace so there can be
differences in approaches used.</p>
<p>This document serves as a guide to the <em>current</em> conventions and preferences. It
is intended to serve as a guide for teams creating new applications and for
teams iterating older ones. If you are creating a new application do also
consult the guides on <a href="/manual/setting-up-new-rails-app.html">setting up a new Rails application</a> and
<a href="/manual/naming.html">how to name an application</a>.</p>
<p>Non-Rails GOV.UK applications may still benefit from these conventions.
Consider applying them if they do not conflict with existing
conventions in an adopted framework.</p>
<h2 id='our-approach'>Our approach</h2><p>GOV.UK&rsquo;s use of Rails is intended to be consistent with the conventions of
the framework itself and we intend to embrace developments and deprecations
from the framework. Where GOV.UK apps differ from Rails conventions (such as
using the RSpec testing framework) these are intended to be consistent with
common industry practices.</p>
<h2 id='tooling-choices'>Tooling choices</h2><h3 id='use-gov-uk-supporting-gems'>Use GOV.UK supporting Gems</h3><p>GOV.UK have published a number of gems that help achieve common needs across
Ruby / Rails applications:</p>

<ul>
<li><a href="https://github.com/alphagov/gds-api-adapters">gds-api-adapters</a> - provides common patterns to communicate between GOV.UK
applications</li>
<li><a href="https://github.com/alphagov/gds-sso">gds-sso</a> - integration with <a href="https://github.com/alphagov/signon">signon</a> for user and application
authentication</li>
<li><a href="https://github.com/alphagov/govuk_app_config">govuk_app_config</a> - provides common configuration for applications such as
logging, error handling and metric reporting</li>
<li><a href="https://github.com/alphagov/govuk_message_queue_consumer">govuk_message_queue_consumer</a> - provides a consistent means to work with
the the RabbitMQ queue that the <a href="https://github.com/alphagov/publishing-api">Publishing API</a> broadcasts to</li>
<li><a href="https://github.com/alphagov/govuk_publishing_components">govuk_publishing_components</a> - provides a framework for embedding common
GOV.UK interface components and creating your own application specific ones</li>
<li><a href="https://github.com/alphagov/govuk_sidekiq">govuk_sidekiq</a> - Provides common configuration for using sidekiq with
GOV.UK infrastructure</li>
<li><a href="https://github.com/alphagov/govuk_schemas">govuk_schemas</a> - Provides helper utilities for interfacing with
<a href="https://github.com/alphagov/govuk-content-schemas">govuk-content-schemas</a></li>
<li><a href="https://github.com/alphagov/govuk_test">govuk_test</a> - Provides configuration and dependencies for headless browser
testing</li>
<li><a href="https://github.com/alphagov/plek">plek</a> - Utility tool to access determine base URLs for GOV.UK applications
for the current environment</li>
<li><a href="https://github.com/alphagov/rubocop-govuk">rubocop-govuk</a> - Provides GOV.UK linting rules for Ruby, Rails, RSpec and
Rake</li>
<li><a href="https://github.com/alphagov/scss-lint-govuk">scss-lint-govuk</a> - Provides linting for SCSS files according to GDS
conventions</li>
<li><a href="https://github.com/alphagov/slimmer">slimmer</a> - Provides consistent templating for apps that serve content on
the www.gov.uk host</li>
</ul>
<p>Using these helps maintain consistency across the programme and enables common
iterations to be pushed out. It is encouraged that gems are iterated or issues
filed (<a href="https://github.com/alphagov/govuk_app_config/issues/121">example</a>) when apps need to vary from conventions
introduced by these gems.</p>
<h3 id='data-storage'>Data storage</h3><p>For non-specialist database needs you should use
<a href="https://www.postgresql.org/">PostgreSQL</a> with <a href="https://guides.rubyonrails.org/active_record_basics.html">ActiveRecord</a>. The
<a href="https://github.com/alphagov/content-publisher/blob/master/db/seeds.rb">db/seeds.rb</a> can be used to populate the database for development and test
environments.</p>
<p>For <a href="https://en.wikipedia.org/wiki/Key-value_database">key-value datastore</a> access (such as queues or distributed caches)
<a href="https://redis.io/">Redis</a> should be used. Typically a Redis datastore will not be shared
between applications, for queue-based communication between applications we
have precedent for using <a href="https://www.rabbitmq.com/">RabbitMQ</a> via the <a href="https://github.com/ruby-amqp/bunny">Bunny</a> gem.</p>
<p>For file storage local to an application <a href="https://aws.amazon.com/s3/">Amazon S3</a> is the preferred choice,
where this needs to be associated with a database <a href="https://guides.rubyonrails.org/active_storage_overview.html">ActiveStorage</a> should be
used.</p>
<h3 id='background-job-processing'>Background job processing</h3><p>The preferred approach for background job processing is to use <a href="https://guides.rubyonrails.org/active_job_basics.html">ActiveJob</a>
with <a href="https://sidekiq.org">Sidekiq</a> with the <a href="https://github.com/alphagov/govuk_sidekiq">govuk_sidekiq</a> gem providing configuration.
ActiveJob is preferred due to it&rsquo;s closer integration of Rails components
(such as <a href="https://guides.rubyonrails.org/action_mailer_basics.html">ActionMailer</a>).</p>
<p>Scheduled background jobs for applications should also make use of Sidekiq,
where <a href="https://github.com/moove-it/sidekiq-scheduler">sidekiq-scheduler</a> is the conventional choice to achieve this.</p>
<h3 id='javascript-package-management'>JavaScript package management</h3><p>For Rails applications you should use the <a href="https://yarnpkg.com">Yarn</a> package
manager for JavaScript packages. Yarn is preferable to using
<a href="https://www.npmjs.com/">NPM</a> as Rails <a href="https://guides.rubyonrails.org/5_1_release_notes.html#yarn-support">integrates</a> directly
with Yarn, providing default tasks and automating some workflows.</p>
<h3 id='frontend-assets'>Frontend assets</h3><p>GOV.UK applications use the Rails <a href="https://guides.rubyonrails.org/asset_pipeline.html">asset pipeline</a> for building assets. We
aspire to migrate to <a href="https://github.com/rails/webpacker">webpacker</a> as the conventional approach when we have
resolved <a href="https://github.com/alphagov/govuk_publishing_components/issues/505">blocking issues</a>.</p>
<h3 id='sending-emails'>Sending emails</h3><p><a href="https://www.notifications.service.gov.uk/">GOV.UK Notify</a> is the preferred approach for sending email. The
<a href="https://github.com/dxw/mail-notify">mail-notify</a> gem is conventionally used to integrate Notify with
<a href="https://guides.rubyonrails.org/action_mailer_basics.html">ActionMailer</a>. There is <a href="/manual/govuk-notify.html">further documentation</a> on how
GOV.UK applications use Notify.</p>
<h3 id='testing-utilities'>Testing utilities</h3><p>The preferred framework for testing Rails applications is <a href="https://relishapp.com/rspec/rspec-rails/docs">rspec-rails</a> where
we aim to adhere to the project&rsquo;s conventions. <a href="https://github.com/alphagov/rubocop-govuk">rubocop-govuk</a> provides
a linting configuration for RSpec. For mocking and test doubles you should use
the provided <a href="https://relishapp.com/rspec/rspec-mocks/docs">rspec-mocks</a> framework.</p>
<p>When working with rspec-rails we prefer merging the <a href="https://github.com/rspec/rspec-core/blob/7b6b9c3f2e2878213f97d6fc9e9eb23c323cfe1c/lib/rspec/core/project_initializer/spec/spec_helper.rb">spec_helper.rb</a> and
<a href="https://github.com/rspec/rspec-rails/blob/a9e3f18c47cf83e0a40c3870f3bab5fe2f4e609a/lib/generators/rspec/install/templates/spec/rails_helper.rb">rails_helper.rb</a> files into a <a href="https://github.com/alphagov/content-publisher/blob/92eb7afe4344d32905b30204c94e033332342e6b/spec/spec_helper.rb">single spec_helper.rb</a> to avoid the
complexities of two configuration files. We also choose to specify
<a href="https://github.com/alphagov/content-publisher/blob/92eb7afe4344d32905b30204c94e033332342e6b/.rspec"><code>--require spec_helper</code></a> in a <a href="https://github.com/rspec/rspec/wiki#rspec"><code>.rspec</code> file</a>
to avoid prefixing every test with <code>require &quot;spec_helper&quot;</code>.</p>
<p>Common tools used with RSpec are:</p>

<ul>
<li><a href="https://github.com/bblimke/webmock">webmock</a> gem to stub HTTP requests - for stubbing communication between
GOV.UK applications <a href="https://github.com/alphagov/gds-api-adapters">gds-api-adapters</a> provides a library of helper methods
that are preferred to manual stubbing;</li>
<li><a href="https://github.com/colszowka/simplecov">SimpleCov</a> for monitoring code coverage;</li>
<li><a href="https://github.com/thoughtbot/factory_bot_rails">factory_bot_rails</a> for providing fixtures/test data;</li>
<li><a href="https://github.com/thoughtbot/climate_control">Climate Control</a> gem for modifying environment variables within tests;</li>
<li><a href="https://api.rubyonrails.org/v6.0.2/classes/ActiveSupport/Testing/TimeHelpers.html"><code>ActiveSupport::Testing::TimeHelpers</code></a> for time manipulation.</li>
</ul>
<p>The conventional testing framework for JavaScript files in GOV.UK Rails
applications is <a href="https://github.com/jasmine/jasmine-gem">jasmine</a>. This is dictated by jasmine integrating
with the <a href="#frontend-assets">asset-pipeline</a> which rules out other common JavaScript testing
frameworks such as Jest or Karma. <a href="https://github.com/alphagov/content-publisher/blob/f26d9b551842fdf2084159b5b7f1bb078da56936/spec/javascripts/support/jasmine_helper.rb">Jasmine should be configured to run tests
with Chrome headless</a> as opposed to the default PhantomJS
(which is a project no longer under development).</p>
<h2 id='configuration'>Configuration</h2><h3 id='embrace-12-factor-conventions'>Embrace 12 factor conventions</h3><p>GOV.UK Rails applications aim to follow
<a href="https://12factor.net/">12 factor</a> conventions. These should manifest in your
Rails application with practices such as:</p>

<ul>
<li>environmental configuration done by environment variables, for example using
<code>ENV[&quot;DATABASE_URL&quot;]</code> over hardcoding the production database configuration;</li>
<li>close parity between development and production environments, for example using
PostgreSQL in all environments - as opposed to SQLite for development and
PostgreSQL for production;</li>
<li>avoiding, where possible, the need for additional configuration on the
serving machine, for example needing additional Nginx rules to serve requests.</li>
</ul>
<h3 id='inject-secrets-with-environment-variables'>Inject secrets with environment variables</h3><p>The conventional place to store secrets for a GOV.UK Rails application is
<code>config/secrets.yml</code>. All production secrets should be populated with an
environment variable; for dev and test environments it&rsquo;s preferred to leave
a usable dummy default if an actual secret isn&rsquo;t needed
(<a href="https://github.com/alphagov/content-publisher/blob/654d1885dd94e347e236be73d20f2304913bc906/config/secrets.yml">example</a>).</p>
<p>We haven&rsquo;t migrated to using the <a href="https://edgeguides.rubyonrails.org/security.html#custom-credentials">encrypted <code>config/credentials.yml.enc</code>
introduced in Rails 5.2</a>. This approach presents us
with a few problems, most notably that we run our apps in Rails
&ldquo;production&rdquo; environment in numerous places (integration, staging,
production) and need different secrets for them.</p>
<h3 id='use-api_only-mode-for-api-projects'>Use <code>api_only</code> mode for API projects</h3><p>For applications that do not serve requests to a web browser you should
configure the Rails application to be <a href="https://guides.rubyonrails.org/api_app.html">API only</a>, this simplifies Rails by
removing unnecessary functionality. If you need to add a web browser interface
to an API application you should consider creating a distinct frontend
application (for example: <a href="https://github.com/alphagov/email-alert-frontend">email-alert-frontend</a> and <a href="https://github.com/alphagov/email-alert-api">email-alert-api</a>).</p>
<h3 id='editing-of-microcopy-by-non-developers'>Editing of microcopy by non-developers</h3><p>When it is intended for non-developers to edit microcopy in an application it is
conventional to use <a href="https://guides.rubyonrails.org/i18n.html">Rails Internationalization (I18n)</a> to abstract
the copy outside of the application code. We use this even when an application
is only in English. These files are stored in <code>/config/locales</code> as per Rails
convention. You should only use these files for accessing copy and not
for any application configuration.</p>
<h3 id='error-handling'>Error handling</h3><p>GOV.UK Rails applications should anticipate failure and do so gracefully. This
<a href="/manual/errors.html">happens automatically, to a degree, on GOV.UK frontend
applications</a> but not on admin applications where there is more
granular control over error responses. GOV.UK Rails applications should be
configured to provide GOV.UK branded error responses.
<a href="https://github.com/alphagov/content-publisher/pull/1252">Content Publisher</a>  provides an example of implementing this with
the <a href="https://components.publishing.service.gov.uk/component-guide/layout_for_admin">GOV.UK admin layout</a>.</p>
<h2 id='organising-your-code'>Organising your code</h2><p>Organising code in a Rails application is frequently a source of debate and
confusion, <a href="https://medium.com/extreme-programming/what-goes-in-rails-lib-92c74dfd955e">particularly as to what code belongs in the <code>/app</code> directory and
what belongs in the <code>/lib</code> directory</a>. We aim to follow what appears
to be the prevalent convention where:</p>

<ul>
<li><code>/app</code> is used for:

<ul>
<li>the default Rails components (such as controllers, models, views, helpers, jobs)</li>
<li>commonly used classes in the application that have a common purpose and
interface (good example: <a href="https://github.com/alphagov/content-publisher/tree/92eb7afe4344d32905b30204c94e033332342e6b/app/interactors">interactors</a>, consistent interface and usage;
bad example: <a href="https://github.com/alphagov/specialist-publisher/blob/077123cc45c86e39d16be2ce2df239adef6ed2d3/app/reporters">reporters</a>, just a one-off class)</li>
</ul></li>
<li><code>/lib</code> is used for:

<ul>
<li>classes that don&rsquo;t logically fit into an app directory</li>
<li>complex business logic for the application, (for example, <a href="https://github.com/alphagov/publishing-api/blob/6595cd840e56aefd29964a2df5e86bd397869034/lib/link_expansion.rb">link expansion</a>
in the Publishing API)</li>
<li>Rake tasks</li>
</ul></li>
</ul>
<p>GOV.UK Rails applications should avoid creating an <code>/app/lib</code> directory, as this
causes confusion with the prevalent <code>/lib</code> directory.</p>
<p>Configuration for applications, typically <a href="https://yaml.org/">YAML</a> files, should live in the
<code>/config</code> directory.</p>
<h2 id='documenting-your-decisions'>Documenting your decisions</h2><p>It&rsquo;s conventional to create a <code>/docs</code> directory in GOV.UK Rails applications to
store application documentation (which is typically linked to from the readme).</p>
<p>For recording the reasoning behind architectural decisions it&rsquo;s conventional
to use <a href="http://thinkrelevance.com/blog/2011/11/15/documenting-architecture-decisions">architectural decision records</a> in the <code>/docs/adr</code> directory
(<a href="https://github.com/alphagov/content-publisher/blob/master/docs/adr/0002-use-local-datastore.md">example</a>).</p>
<h2 id='testing-strategies'>Testing strategies</h2><p>We aim for well tested Rails applications that provide a good degree of coverage
and provide assurances that an application is operating correctly. We value
test suites that are fast to run, easy to read and <a href="https://github.com/alphagov/content-publisher/blob/f26d9b551842fdf2084159b5b7f1bb078da56936/docs/testing-strategy.md">test things consistently at
different abstractions (unit, integration and functional)</a>.</p>
<h3 id='featuresystem-testing'>Feature/system testing</h3><p>When testing Rails applications from the perspective of an end user it is
conventional to use RSpec Rails&rsquo; <a href="https://relishapp.com/rspec/rspec-rails/docs/feature-specs/feature-spec">feature specs</a> (new applications should
use the more modern equivalent <a href="https://relishapp.com/rspec/rspec-rails/docs/system-specs/system-spec">system specs</a>) via <a href="https://github.com/alphagov/govuk_test">govuk_test</a>&rsquo;s
<a href="https://teamcapybara.github.io/capybara/">Capybara</a> configuration.</p>
<p>GOV.UK have adopted the <a href="https://www.futurelearn.com/info/blog/how-we-write-readable-feature-tests-with-rspec">Future Learn readable feature test</a>
approach to writing feature tests in RSpec. This offers a similar level of
readability of a <a href="https://cucumber.io/">cucumber</a> test, without the difficulties in identifying
the code used to perform the test.</p>
<h3 id='testing-controllers'>Testing controllers</h3><p>For testing controllers in Rails applications it is recommended to use
<a href="https://relishapp.com/rspec/rspec-rails/docs/request-specs/request-spec">request specs</a>, which have been the <a href="https://medium.com/just-tech/rspec-controller-or-request-specs-d93ef563ef11">recommended
approach</a> to replace <a href="https://relishapp.com/rspec/rspec-rails/docs/controller-specs">controller specs</a> reflecting the
<a href="https://github.com/rails/rails/issues/18950">direction of Rails 5</a>.</p>


  <div class='related-content'>

    <h3>More in the Applications section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/architecture-deep-dive.html">Architectural deep-dive of GOV.UK</a></li>
            <li><a href="/manual/architecture.html">Architecture overview of GOV.UK applications</a></li>
            <li><a href="/manual/non-ha-node-classes.html">Node classes without redundancy</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/add-authentication-to-an-application.html">Add authentication to an application</a></li>
            <li><a href="/manual/naming.html">Name a new application or gem</a></li>
            <li><a href="/manual/retiring-an-application.html">Retire an application</a></li>
            <li><a href="/manual/setting-up-new-rails-app.html">Set up a new Rails application</a></li>
          </ul>
        </div>

    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2021-05-26">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 26 May 2020.

        It needs to be reviewed again on 26 May 2021
        by the page owner <a href="">#govuk-developers</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 26 May 2021
       by the page owner <a href="">#govuk-developers</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/conventions-for-rails-applications.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Conventions%20for%20Rails%20applications'&amp;body=Problem%20with%20'Conventions%20for%20Rails%20applications'%20(https://docs.publishing.service.gov.uk/manual/conventions-for-rails-applications.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
