


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>AWS IAM Key Rotation - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/aws-iam-key-rotation.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="AWS IAM Key Rotation" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/aws-iam-key-rotation.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="AWS IAM Key Rotation - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/aws-iam-key-rotation.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>AWS IAM Key Rotation</span></a>
    <ul>
      <li>
        <a href="#overview"><span>Overview</span></a>
      </li>
      <li>
        <a href="#how-to-rotate-access-keys"><span>How to rotate Access Keys</span></a>
        <ul>
          <li>
            <a href="#1-find-users-access-key"><span>1. Find users access key</span></a>
          </li>
          <li>
            <a href="#2-find-out-if-the-key-is-used"><span>2. Find out if the key is used</span></a>
          </li>
          <li>
            <a href="#3-find-where-the-key-is-used"><span>3. Find where the key is used</span></a>
          </li>
          <li>
            <a href="#4-create-and-deploy-new-key"><span>4. Create and deploy new key</span></a>
          </li>
          <li>
            <a href="#5-ensure-new-key-is-being-used"><span>5. Ensure new key is being used</span></a>
          </li>
          <li>
            <a href="#6-remove-the-old-key"><span>6. Remove the old key</span></a>
          </li>
          <li>
            <a href="#7-record-where-the-key-is-used"><span>7. Record where the key is used</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#command-line-interface"><span>Command Line Interface</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#aws'>AWS</a></p> <h1 id='header'>AWS IAM Key Rotation</h1><h2 id='overview'>Overview</h2><p>GOV.UK uses <a href="https://docs.aws.amazon.com/en_pv/IAM/latest/UserGuide/id_users.html">AWS IAM</a> accounts to manage applications access to our AWS
infrastructure. The <a href="https://docs.aws.amazon.com/en_pv/IAM/latest/UserGuide/id_credentials_access-keys.html">Access Keys</a> associated with these accounts need to be
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_RotateAccessKey">rotated</a> every 3 months.</p>
<p>Rotating AWS IAM keys requires permissions which are available with the <code>admin</code>,
<code>internal-admin</code>, <code>platformhealth-poweruser</code> or <code>poweruser</code> roles. You&rsquo;ll be
able to rotate keys only if you can assume one of these roles.</p>
<h2 id='how-to-rotate-access-keys'>How to rotate Access Keys</h2><p>Log in to the <a href="https://console.aws.amazon.com/iam/home?region=eu-west-1#/users">IAM Management Console</a> in the environment you want to rotate
keys for and you&rsquo;ll see a list of users and the age of their access keys.</p>
<h3 id='1-find-users-access-key'>1. Find users access key</h3>
<ul>
<li>Click on the user whose key you want to rotate.</li>
<li>Click on the <code>Security Credentials</code> tab.</li>
</ul>
<p>Users should always only have one access key. The only time a user should have
two keys is when we are in the process of rotating the key that is in use. For
this reason, AWS allow users to have a maximum of two Access Keys at the same
time.</p>

<ul>
<li>Make a note of the <code>Access Key ID</code>.</li>
<li>Proceed to <a href="#2-find-out-if-the-key-is-used">find out if the key is used</a>.</li>
</ul>

<blockquote>
<p><strong>Note</strong></p>
<p>If a user has two keys, the first task is to remove one of them.</p>
<p>If one key <a href="#2-find-out-if-the-key-is-used">is not in use</a>, you can
<a href="#6-remove-the-old-key">remove it</a> and rotate the other key (keep reading to
see how).</p>
<p>If both keys are in use, you need to pick one and
<a href="#3-find-where-the-key-is-used">replace all uses of it</a> with the other key.
Then, once it&rsquo;s no longer in use, you can <a href="#6-remove-the-old-key">remove it</a>
and rotate the other key (keep reading to see how).</p>
</blockquote>
<h3 id='2-find-out-if-the-key-is-used'>2. Find out if the key is used</h3>
<ul>
<li>Check the <code>Last used</code> value.</li>
<li>If the value is a date,
<a href="#3-find-where-the-key-is-used">find where the key is used</a>.</li>
<li>If it&rsquo;s <code>N/A</code>, you can safely <a href="#6-remove-the-old-key">remove the key</a> as it
isn&rsquo;t used.</li>
</ul>
<h3 id='3-find-where-the-key-is-used'>3. Find where the key is used</h3><p>When searching for keys, keep in consideration that they may be present in
<a href="https://github.com/alphagov/govuk-secrets">govuk-secrets</a> or in the control panel of 3rd party services, such as Fastly or
Logit. Keys may also be shared across AWS and Carrenza environments.</p>
<p>Firstly, search for the key in <a href="https://github.com/alphagov/govuk-secrets">govuk-secrets</a>:</p>

<ul>
<li>Enter <a href="https://github.com/alphagov/govuk-secrets/tree/master/puppet">govuk-secrets/puppet</a> in your machine.</li>
<li>Run the appropriate <a href="https://github.com/alphagov/govuk-secrets/tree/master/puppet_aws#common-actions">Puppet AWS common actions</a> considering the following:

<ul>
<li>The command to run is related to the environment you need to target. For
example, to edit global staging credentials in the <code>govuk::apps</code> namespace,
you need to run <code>bundle exec rake &#39;eyaml:edit[staging,apps]&#39;</code>.</li>
<li>You may need to run more than one command. For example, to edit the global
integration credentials both in and out of the <code>govuk::apps</code> namespace, you
need run both <code>$ bundle exec rake &#39;eyaml:edit[integration]&#39;</code> and
<code>$ bundle exec rake &#39;eyaml:edit[integration,apps]&#39;</code>.</li>
</ul></li>
<li>Search for the <code>Access Key ID</code> in the result.</li>
</ul>
<p>Repeat the previous steps for <a href="https://github.com/alphagov/govuk-secrets/tree/master/puppet_aws">govuk-secrets/puppet_aws</a>:</p>

<ul>
<li>Enter <a href="https://github.com/alphagov/govuk-secrets/tree/master/puppet_aws">govuk-secrets/puppet_aws</a>.</li>
<li>Run the same command(s) again.</li>
<li>Search for the <code>Access Key ID</code> in the result.</li>
</ul>
<p>Keys may also be defined in more then one place. For example, the hieradata
values <code>govuk::apps::support::aws_access_key_id</code> and
<code>govuk::apps::support_api::aws_access_key_id</code> contain the same key.</p>
<p>Secondly, search for the key in the control panel of 3rd party services we use,
for example, Fastly or Logit.</p>
<p>If it isn&rsquo;t present in <code>govuk-secrets</code> hieradata, nor in any 3rd party services,
you can safely <a href="#6-remove-the-old-key">remove the key</a>.</p>
<h3 id='4-create-and-deploy-new-key'>4. Create and deploy new key</h3>
<ul>
<li>Click <code>Create access key</code> in <code>Security credentials</code>.</li>
<li>If the key to change was in a 3rd party service:

<ul>
<li>Replace the old <code>Access Key ID</code> and <code>Secret access key</code> with the new ones.</li>
</ul></li>
<li>If the key to change was in <code>govuk-secrets</code>:

<ul>
<li>Replace the old <code>Access Key ID</code> and <code>Secret access key</code> with the new ones.</li>
<li>Redeploy <a href="https://github.com/alphagov/govuk-puppet">govuk-puppet</a> so it picks up the new key.</li>
<li>Either wait up to 30 minutes for this to take effect or run
<code>govuk_puppet --verbose</code> in the machine that uses that key.</li>
</ul></li>
</ul>
<h3 id='5-ensure-new-key-is-being-used'>5. Ensure new key is being used</h3><p>Ensure that the <code>Last used</code> values change to show that the new key is being
used and the old key is not used. Keys that are used infrequently may take a
while to update and updates can take a few minutes to show in the control panel.</p>
<p>If the <code>Last used</code> time of the old key continues to change, the key has not been
completely removed so you&rsquo;ll need to
<a href="#3-find-where-the-key-is-used">find where the key is used</a> again.</p>
<p>If the <code>Last used</code> time of the old key doesn&rsquo;t change anymore, you can
<a href="#6-remove-the-old-key">remove the key</a>.</p>
<h3 id='6-remove-the-old-key'>6. Remove the old key</h3><p>Old keys can either be deleted or made inactive. Making the key inactive will
prevent the key from being used, but it can quickly be made active again. This
is useful if you are not confident that all uses of the key have been updated.
In production systems, this could prevent minor outages scaling into incidents.</p>

<ul>
<li>Notify <a href="/manual/2nd-line.html">2ndline</a> that you are about to delete a key or make a key inactive.</li>
<li>Click <code>Make inactive</code> to inactivate the key or click the <code>X</code> to delete it.</li>
</ul>
<h3 id='7-record-where-the-key-is-used'>7. Record where the key is used</h3>
<ul>
<li>Record your findings of where the key is used in the
<a href="https://docs.google.com/spreadsheets/d/1L6H3-wh9J1p18fjnODmit2WbGOA8wZgr5wL-5wN0IgE/edit#gid=0">GOV.UK AWS User Keys spreadsheet</a>.</li>
</ul>
<h2 id='command-line-interface'>Command Line Interface</h2><p>It&rsquo;s also possible to view and update access keys with the <a href="https://aws.amazon.com/blogs/security/how-to-rotate-access-keys-for-iam-users/">AWS CLI</a>.</p>


  <div class='related-content'>

    <h3>More in the AWS section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/govuk-in-aws.html">Migration to AWS</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/set-up-gcp-account.html">Set up your GCP account</a></li>
            <li><a href="/manual/howto-ssh-to-machines.html">SSH into machines</a></li>
          </ul>
        </div>

    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2020-07-20">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 20 January 2020.

        It needs to be reviewed again on 20 July 2020
        by the page owner <a href="">#govuk-developers</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 20 July 2020
       by the page owner <a href="">#govuk-developers</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/aws-iam-key-rotation.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'AWS%20IAM%20Key%20Rotation'&amp;body=Problem%20with%20'AWS%20IAM%20Key%20Rotation'%20(https://docs.publishing.service.gov.uk/manual/aws-iam-key-rotation.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
