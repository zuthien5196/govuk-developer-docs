


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Deployments for data.gov.uk - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/data-gov-uk-deployment.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Deployments for data.gov.uk" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/data-gov-uk-deployment.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Deployments for data.gov.uk - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/data-gov-uk-deployment.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Deployments for data.gov.uk</span></a>
    <ul>
      <li>
        <a href="#find-and-publish-rails-apps"><span>Find and Publish (Rails Apps)</span></a>
        <ul>
          <li>
            <a href="#continuous-integration"><span>Continuous Integration</span></a>
          </li>
          <li>
            <a href="#heroku-integration-environment"><span>Heroku Integration Environment</span></a>
          </li>
          <li>
            <a href="#paas-staging-and-production-environments"><span>PaaS Staging and Production Environments</span></a>
          </li>
          <li>
            <a href="#set-up-interactive-ssh-session"><span>Set up interactive SSH session</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#ckan"><span>CKAN</span></a>
        <ul>
          <li>
            <a href="#csw"><span>CSW</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#data-gov-uk'>data.gov.uk</a></p> <h1 id='header'>Deployments for data.gov.uk</h1><h2 id='find-and-publish-rails-apps'>Find and Publish (Rails Apps)</h2><h3 id='continuous-integration'>Continuous Integration</h3><p>Travis is configured for both <a href="https://travis-ci.org/alphagov/datagovuk_publish/">Publish (CI)</a> and <a href="https://travis-ci.org/alphagov/datagovuk_find">Find (CI)</a> according to <code>.travis.yml</code> file in each repo. Each PR request should automatically build a <a href="https://docs.publishing.service.gov.uk/manual/review-apps.html#header">Heroku Review App</a>, which can be accessed from the PR page on GitHub.</p>
<h3 id='heroku-integration-environment'>Heroku Integration Environment</h3><p>Heroku has a pipeline for each of <a href="https://dashboard.heroku.com/pipelines/7fb4c1c1-618e-42da-ba71-1cb0beb6c5c8">Publish</a> and <a href="https://dashboard.heroku.com/pipelines/0ca23219-ac0e-4d6c-9d5f-40829c6209db">Find</a>, with each app set to run in its &lsquo;integration&rsquo; environment. Each pipeline has a permanent instance of the app, providing a common instance of Elasticsearch for us by the <a href="/apps/datagovuk_find.html">Find</a> PR apps.</p>
<p>Each repo has a <code>Procfile</code> and an <code>app.json</code> file, which help to specify how the app is deployed. The environment variables (&lsquo;Config Vars&rsquo;) are then set via the website, both for the permanent app instance, and the review app template.</p>
<p>Note: At the moment the Heroku deployed apps do not have much data in them as they are not hooked up with the Integration environment so should be purely used to test frontend changes and not as an end to end test of the Integration stack.</p>
<h3 id='paas-staging-and-production-environments'>PaaS Staging and Production Environments</h3><p><a href="/apps/datagovuk_publish.html">Publish</a> and <a href="/apps/datagovuk_find.html">Find</a> are provisioned on <a href="https://docs.cloud.service.gov.uk/#set-up-command-line">GOV.UK PaaS</a>. Each app repo
contains a set of manifests that specify the container settings for when it&rsquo;s
deployed.</p>
<p>The deployment for both apps can be triggered automatically via GitHub flow, or
manually via command line tools.</p>
<h4 id='staging'>Staging</h4><p>The deployment to staging is triggered when a PR gets merged into master. You
can check the <a href="https://travis-ci.org/alphagov/datagovuk_find">Travis logs of the <code>master</code> build</a> to see progress.</p>
<p>You can check the deployment on <a href="https://staging.data.gov.uk/">staging.data.gov.uk</a></p>
<h4 id='production'>Production</h4><p>The deployment to production is triggered when a <a href="https://github.com/alphagov/datagovuk_find/releases">new release</a> with an appropriate version
number is created in GitHub.</p>
<p>To create a new release, provide a new version number, release title and description. The version number must include the leading &lsquo;v&rsquo; to trigger a deployment, for example: <code>v1.0.0</code></p>
<p>This deployment behaviour is defined in <a href="https://github.com/alphagov/datagovuk_publish/blob/master/.travis.yml#L30-L50">Publish&rsquo;s travis.yml</a>
and in <a href="https://github.com/alphagov/datagovuk_find/blob/af8cfa61584b16e4e1ad7bedbd1b7f890cec940d/.travis.yml#L44-L48">Find&rsquo;s travis.yml</a>.</p>
<p>The process to manually deploy is as follows.</p>
<div class="highlight"><pre class="highlight plaintext"><code>## run once to install the plugin
cf add-plugin-repo CF-Community https://plugins.cloudfoundry.org
cf install-plugin autopilot -r CF-Community -f

## manually deploy the publish app
cf zero-downtime-push publish-data-beta-staging -f staging-app-manifest.yml
cf zero-downtime-push publish-data-beta-staging-worker -f staging-worker-manifest.yml
</code></pre></div><p>There are <a href="https://github.com/alphagov/datagovuk_publish/tree/master/scripts">some scripts available for datagovuk_publish</a> which can run a deploy for you, for example:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ cd datagovuk_publish
$ git pull
$ ./scripts/deploy-staging.sh
$ ./scripts/deploy-production.sh
</code></pre></div><p>For more advanced uses of the PaaS that are not covered in the PaaS internal documentation (e.g. provisioning an app using a buildpack that is not Ruby or Java), refer to the <a href="https://docs.cloudfoundry.org">Cloud Foundry documentation</a>.</p>
<h3 id='set-up-interactive-ssh-session'>Set up interactive SSH session</h3><p>You may need this to run things such as rake tasks:</p>
<div class="highlight"><pre class="highlight plaintext"><code>/tmp/lifecycle/shell
</code></pre></div><p>You need to run this every time you start an SSH session.</p>
<p>For more information, refer to the <a href="https://docs.cloudfoundry.org/devguide/deploy-apps/ssh-apps.html#ssh-env">Cloud Foundry documentation on SSH Session Environment</a>.</p>
<h2 id='ckan'>CKAN</h2><p><a href="https://github.com/alphagov/ckanext-datagovuk">CKAN</a> uses GOV.UK infrastructure, which includes <a href="/manual/jenkins-ci.html">Jenkins</a> for CI.</p>
<p>Integration, staging and production environments behave like all other GOV.UK applications on AWS.</p>
<p>Deployments for ckan are initiated via updates to <a href="https://github.com/alphagov/ckanext-datagovuk">ckanext-datagovuk</a>, whenever a ckan extension is updated the <a href="https://github.com/alphagov/ckanext-datagovuk/blob/master/bin/install-dependencies.sh">install-dependencies</a> file will need an update with the relevant extensions (eg. spatial, harvest, dcat) commit or version number.</p>
<h3 id='csw'>CSW</h3><p>When deploying changes that affect the CSW service, (OWSLib or PyCSW updates), provided at the <code>/csw</code> endpoint for the <a href="https://ckan.publishing.service.gov.uk">CKAN publisher</a> you should make sure that the endpoint is still running correctly by curling it, <code>curl &quot;https://ckan.publishing.service.gov.uk/csw&quot;</code>, or view it in Firefox. Chrome and Safari do not show the XML on the page correctly.</p>
<p>The daily sync between pycsw and ckan should also be tested:</p>
<div class="highlight"><pre class="highlight plaintext"><code>sudo su deploy
cd /var/apps/ckan &amp;&amp; ./venv/bin/paster --plugin=ckanext-spatial ckan-pycsw load -p /var/ckan/pycsw.cfg -u http://localhost:3220
</code></pre></div><p>The pycsw web process should be automatically restarted after each ckan deployment.</p>
<p>If changes are not appearing, you can try these commands.</p>
<div class="highlight"><pre class="highlight plaintext"><code># show running csw workers
sudo initctl list | grep csw

# restart the pycsw web worker
sudo service pycsw_web-procfile-worker restart
</code></pre></div>

  <div class='related-content'>

    <h3>More in the data.gov.uk section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/data-gov-uk-architecture.html">Architecture of data.gov.uk</a></li>
            <li><a href="/manual/data-gov-uk-contracts-archive.html">Data.gov.uk Contracts Archive</a></li>
            <li><a href="/manual/data-gov-uk-map-previews.html">WMS map previews on data.gov.uk</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/data-gov-uk-2nd-line.html">Common 2nd line support tasks for data.gov.uk</a></li>
            <li><a href="/manual/data-gov-uk-monitoring.html">Monitor data.gov.uk</a></li>
            <li><a href="/manual/data-gov-uk-operations.html">Operation of data.gov.uk</a></li>
            <li><a href="/manual/data-gov-uk-supporting-ckan.html">Support tasks for CKAN</a></li>
          </ul>
        </div>

    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2020-10-07">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 7 April 2020.

        It needs to be reviewed again on 7 October 2020
        by the page owner <a href="">#govuk-datagovuk</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 7 October 2020
       by the page owner <a href="">#govuk-datagovuk</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/data-gov-uk-deployment.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Deployments%20for%20data.gov.uk'&amp;body=Problem%20with%20'Deployments%20for%20data.gov.uk'%20(https://docs.publishing.service.gov.uk/manual/data-gov-uk-deployment.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
