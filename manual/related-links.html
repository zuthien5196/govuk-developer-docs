


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Related links - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/related-links.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Related links" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/related-links.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Related links - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/related-links.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Related links</span></a>
    <ul>
      <li>
        <a href="#manual"><span>Manual</span></a>
      </li>
      <li>
        <a href="#automatic"><span>Automatic</span></a>
        <ul>
          <li>
            <a href="#overview"><span>Overview</span></a>
          </li>
          <li>
            <a href="#when-we-show-the-new-related-links"><span>When we show the new related links</span></a>
          </li>
          <li>
            <a href="#concourse-pipeline-details"><span>Concourse pipeline details</span></a>
          </li>
          <li>
            <a href="#rolling-back-links"><span>Rolling back Links</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#publishing'>Publishing</a></p> <h1 id='header'>Related links</h1><h2 id='manual'>Manual</h2><p>Related links can be added or removed manually through <a href="https://content-tagger.publishing.service.gov.uk">Content Tagger</a>.
To do this, you can click on the <strong>Edit a page</strong> link at the top and enter the
base path of the content item you need to edit. You will then see a section
titled <strong>Related content items</strong> where you can edit the links.</p>
<p>If a request comes in a from a content designer to edit the related links of a
page, you can send them to Content Tagger so they can edit the links
themselves.</p>
<h2 id='automatic'>Automatic</h2><h3 id='overview'>Overview</h3><p>Since July 2019, related links on GOV.UK have been supplemented by links generated through an automated machine learning pipeline. The first job in this pipeline uses data on how pages are linked together (the structural network) and analytics from users&rsquo; behaviour on the site (the functional network) to create a set of most relevant related links for a subset of pages.</p>
<p>Once these links have been created, a second job ingests the links via the Publishing API to be shown to users navigating the site.</p>
<p>The code for the process of generating and ingesting related links can be found in the <a href="https://github.com/alphagov/govuk-related-links-recommender">govuk-related-links-recommender repository on GitHub</a>.</p>
<h3 id='when-we-show-the-new-related-links'>When we show the new related links</h3><p>Machine learning generated related links are created exclusively for Whitehall content, with a number of measures in place to ensure that we always show manually curated links set by publishers.</p>

<ul>
<li>Related links are only generated for a number of content types, with exclusions in place for content that should not be linked <em>from</em>, linked <em>to</em>, or both. These exclusions can be found at https://github.com/alphagov/govuk-related-links-recommender/tree/master/src/config.</li>
<li>Generated related links are stored within the <code>suggested_ordered_related_items</code> property of a content item, while all existing and manually curated links continue to be stored within the <code>ordered_related_items</code> property.</li>
<li>If links exist with <code>ordered_related_items</code> for a content item, we do not show generated related links.</li>
<li>Requests need to have the header <code>Govuk-Use-Recommended-Related-Links</code> header set to <code>True</code> in order to show suggested related links - <a href="https://github.com/alphagov/govuk-cdn-config/blob/master/vcl_templates/www.vcl.erb#L238">this is set by the CDN for all requests</a>.</li>
</ul>
<h3 id='concourse-pipeline-details'>Concourse pipeline details</h3><p>Related links are generated and ingested via the following jobs, which are defined in the <a href="https://cd.gds-reliability.engineering/teams/govuk-tools/pipelines/govuk-related-links">govuk-related-links pipeline on Concourse</a>.</p>
<h4 id='link-generation'><code>link-generation</code></h4><p>This job runs the process to generate new related links for a subset of pages on GOV.UK, via the <code>provision-generation-machine</code> and <code>run_link_generation</code> scripts, which in turn triggers the Python script <code>run_all.py</code>.</p>
<p>The related links generated from this process are stored in an S3 environment-specific <code>govuk-related-links</code> bucket.</p>
<p>Currently, this job is scheduled to run once every three weeks via a <code>time</code> resource attached to the production <code>run-generation-production</code> step.</p>
<h4 id='link-ingestion'><code>link-ingestion</code></h4><p>This job runs the process of ingesting related links via the Publishing API.</p>
<p>Links are retrieved from the environment-specific S3 bucket mentioned previously and then fed (in batches) to the Publishing API. There is a 20 minute delay between batches. Exclusions are applied during this stage from a <code>related_link_exclusions.json</code> file which is available in S3; for these links, we obtain the respective content ids and use them to remove any suggested links that may exist for the current batch of links being ingested.</p>
<p>Currently, this job is triggered manually after reviewing a spreadsheet of the generated related links; it will be scheduled to run automatically by the end of September 2019.</p>
<h3 id='rolling-back-links'>Rolling back Links</h3><p>Should we ever need to roll back any suggested related links, there are a number of ways we can do this.</p>
<h4 id='links-for-individual-pages'>Links for individual pages</h4><p>To rollback suggested related links for an individual page (to show the original related links), use the <a href="https://deploy.publishing.service.gov.uk/job/run-rake-task/">Run rake task job on Jenkins</a> with the following parameters set:
  - <code>TARGET_APPLICATION: publishing-api</code>
  - <code>MACHINE_CLASS: publishing_api</code>
  - <code>RAKE_TASK: content:reset_related_links_for_pages[&#39;CONTENT_ID’]</code>, where <code>CONTENT_ID</code> is the content id of the page to remove suggested links from</p>
<h4 id='links-for-certain-document-types'>Links for certain document types</h4><p>To exclude a document type or page from having links generated <em>to</em> it, <em>from</em> it, or both, <a href="https://github.com/alphagov/govuk-related-links-recommender/tree/master/src/config">update the exclusions in the GitHub repository</a>. Note: this will take effect from the <em>next</em> time the related links generation process is run, and will not affect current links.</p>
<h4 id='suspending-all-suggested-related-links'>Suspending all suggested related links</h4><p>To immediately and temporarily stop showing all suggested related links (for example, if a problem has led to bad links being generated for a large percentage of content / high traffic content), you will need to update the CDN to set the <code>Govuk-Use-Recommended-Related-Links</code> header to <code>False</code> and then <a href="https://deploy.publishing.service.gov.uk/job/Deploy_CDN/">deploy the CDN</a> for <code>vhost: www</code>.</p>
<p>The root cause of the problem should be investigated and a new set of related links generated and ingested through the pipeline, if possible. Should the fix not be immediate, we might consider re-ingesting an older batch of related links from S3.</p>


  <div class='related-content'>

    <h3>More in the Publishing section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/content-preview.html">How the draft stack works</a></li>
            <li><a href="/manual/taxonomy.html">How the topic taxonomy works</a></li>
            <li><a href="/manual/world-taxonomy.html">How the world taxonomy works</a></li>
            <li><a href="/manual/schemas.html">What data we expose as schema.org structured data</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/add-a-new-document-type.html">Add a new document type</a></li>
            <li><a href="/manual/whitehall-historical-accounts.html">Add Historical Accounts</a></li>
            <li><a href="/manual/add-translation-whitehall.html">Add support for a new translation in Whitehall</a></li>
            <li><a href="/manual/howto-change-slug-and-create-redirect.html">Change a slug and create redirect in Whitehall</a></li>
            <li><a href="/manual/change-base-path-in-specialist-publisher.html">Change a specialist document base path</a></li>
            <li><a href="/manual/incorrect-content-in-search-or-navigation.html">Content that doesn't show up correctly in search or list pages</a></li>
            <li><a href="/manual/documents-are-published-but-links-arent-updated.html">Debug published documents with incorrect links</a></li>
            <li><a href="/manual/emergency-publishing.html">Deploy emergency publishing banners</a></li>
            <li><a href="/manual/global-banner.html">Deploy non-emergency global banner</a></li>
            <li><a href="/manual/howto-find-hardcoded-markup-govspeak.html">Find hardcoded markup in GovSpeak</a></li>
            <li><a href="/manual/help-with-publishing-content.html">Help with publishing content</a></li>
            <li><a href="/manual/documents-arent-live-after-publishing.html">If documents aren't live after being published</a></li>
            <li><a href="/manual/make-a-new-document-type-available-to-search.html">Make a new document type available to search</a></li>
            <li><a href="/manual/howto-modify-change-note.html">Modify a change note in Publishing API</a></li>
            <li><a href="/manual/howto-redirect-html-attachment-urls-from-whitehall.html">Redirect an HTML attachment's URL in Whitehall</a></li>
            <li><a href="/manual/reindex-elasticsearch.html">Reindex an Elasticsearch index</a></li>
            <li><a href="/manual/howto-remove-change-note-from-whitehall.html">Remove a change note in Whitehall</a></li>
            <li><a href="/manual/rename-a-country.html">Rename a country</a></li>
            <li><a href="/manual/republishing-content.html">Republish content</a></li>
            <li><a href="/manual/government-changes.html">Support government changes</a></li>
            <li><a href="/manual/update-promo-boxes.html">Update homepage promotion slots</a></li>
            <li><a href="/manual/updating-brexit-transition-checker.html">Updating content in the Brexit/Transition Checker</a></li>
            <li><a href="/manual/hmrc-paye-files.html">Upload HMRC PAYE files</a></li>
          </ul>
        </div>

    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2020-07-07">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 7 January 2020.

        It needs to be reviewed again on 7 July 2020
        by the page owner <a href="">#govuk-data-labs</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 7 July 2020
       by the page owner <a href="">#govuk-data-labs</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/related-links.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Related%20links'&amp;body=Problem%20with%20'Related%20links'%20(https://docs.publishing.service.gov.uk/manual/related-links.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
