


<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Test & build a project with GitHub Actions - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html">


      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Test &amp; build a project with GitHub Actions" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta property="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Test &amp; build a project with GitHub Actions - GOV.UK Developer Documentation" />
      <meta property="twitter:url" content="https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Test & build a project with GitHub Actions</span></a>
    <ul>
      <li>
        <a href="#gov-uk-conventions-for-github-actions"><span>GOV.UK Conventions for GitHub Actions</span></a>
        <ul>
          <li>
            <a href="#name-of-ci-workflow-file"><span>Name of CI workflow file</span></a>
          </li>
          <li>
            <a href="#when-the-ci-workflow-should-run"><span>When the CI workflow should run</span></a>
          </li>
          <li>
            <a href="#avoid-superfluous-naming-of-workflows-jobs-and-steps"><span>Avoid superfluous naming of workflows, jobs and steps</span></a>
          </li>
          <li>
            <a href="#prefer-a-single-or-small-number-of-steps-within-a-ci-workflow"><span>Prefer a single or small number of steps within a CI workflow</span></a>
          </li>
          <li>
            <a href="#base-your-workflow-on-one-of-our-documented-examples"><span>Base your workflow on one of our documented examples</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#github-action-examples"><span>GitHub Action Examples</span></a>
        <ul>
          <li>
            <a href="#simple-ruby-application"><span>Simple Ruby Application</span></a>
          </li>
          <li>
            <a href="#a-ruby-gem"><span>A Ruby Gem</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#gov-uk-rails-application-with-postgres-redis-yarn-and-gov-uk-content-schemas-dependencies"><span>GOV.UK Rails application with Postgres, Redis, Yarn and GOV.UK Content Schemas dependencies</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#testing'>Testing</a></p> <h1 id='header'>Test & build a project with GitHub Actions</h1><p><a href="https://github.com/features/actions">GitHub Actions</a> is an automated workflow
system that GOV.UK uses for <a href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration (CI)</a>, we also have
<a href="/manual/testing-projects.html">Jenkins</a> and <a href="/manual/concourse.html">Concourse</a>
that provide similar functionality. In <a href="https://github.com/alphagov/govuk-rfcs/blob/master/rfc-123-github-actions-ci.md">GOV.UK RFC 123</a> we decided that
GitHub Actions is the preferred platform for GOV.UK CI usage where the wider
platform integration of Jenkins is not required.</p>
<p>Please note that we cannot currently make use of the <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets">Secrets</a>
in GitHub Action workflows, there are on-going discussions to resolve this. In
the meantime please <strong>do not add any secrets to workflows</strong>. For further
details of this restriction please contact
<a href="mailto:govuk-senior-tech@digital.cabinet-office.gov.uk">GOV.UK senior tech</a>.</p>
<p>Thus, you should continue to use Jenkins for any projects that need the
following:</p>

<ul>
<li>access to GDS&rsquo; internal network to trigger other internal systems to perform
jobs during or following a build (for example, triggering
<a href="/manual/publishing-e2e-tests.html">publishing end-to-end tests</a> or triggering a deployment);</li>
<li>authentication to external systems (for example, <a href="/manual/publishing-a-ruby-gem.html#releasing-gem-versions">releasing a gem
automatically</a> during a master build).</li>
</ul>
<h2 id='gov-uk-conventions-for-github-actions'>GOV.UK Conventions for GitHub Actions</h2><h3 id='name-of-ci-workflow-file'>Name of CI workflow file</h3><p>You should name the file used for configuring the CI workflow <code>ci.yml</code>.</p>
<h3 id='when-the-ci-workflow-should-run'>When the CI workflow should run</h3><p>The workflow should be configured to run on <a href="https://help.github.com/en/actions/reference/events-that-trigger-workflows#push-event-push"><code>push</code></a> and
<a href="https://help.github.com/en/actions/reference/events-that-trigger-workflows#pull-request-event-pull_request"><code>pull_request</code></a> events. The <code>push</code> event occurs for every
push to the repository and this will generate a build against the branch
that was pushed. The <code>pull_request</code> event occurs whenever a pull request
is opened and it is triggered again any time the pull request changes (such
as extra commits or rebasing), these differ to the <code>push</code> event by merging in
the master branch before running operations. Pull requests from forks of a
repo will only trigger the <code>pull_request</code> event.</p>
<p>For example:</p>
<div class="highlight"><pre class="highlight yaml"><code><span class="c1"># ./github/workflows/ci.yml</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
</code></pre></div><h3 id='avoid-superfluous-naming-of-workflows-jobs-and-steps'>Avoid superfluous naming of workflows, jobs and steps</h3><p>In workflow files you have the option to specify a
<a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#name">name attribute</a> for the workflow itself, the jobs and
each individual step.</p>
<p>The workflow and any jobs should not be given a name as the workflow filename
and job_id should be sufficiently explanatory.</p>
<p>Steps should also not be named, as the text in the run command is normally
sufficiently descriptive. We only should add names to steps where they are
used to either explain a particularly cryptic set of commands or where there
are identically appearing steps that we wish to disambiguate between.</p>
<h3 id='prefer-a-single-or-small-number-of-steps-within-a-ci-workflow'>Prefer a single or small number of steps within a CI workflow</h3><p>Rather than having a number of granular steps (such as: &ldquo;Lint Ruby&rdquo;, &ldquo;Lint JS&rdquo;,
&ldquo;Run Ruby tests&rdquo;, &ldquo;Run JS Tests&rdquo;) prefer a single step (such as <code>bundle exec
rake</code>) where more of the CI task configuration is handled in application code.</p>
<p>This is so we can:</p>

<ul>
<li>keep CI configurations simple and consistent;</li>
<li>make it easier to replicate CI checks in a development environment.</li>
</ul>
<h3 id='base-your-workflow-on-one-of-our-documented-examples'>Base your workflow on one of our documented examples</h3><p>GitHub Actions currently <a href="https://github.community/t5/GitHub-Actions/Templates-for-GitHub-Actions/m-p/52811">lack templating functionality</a>
to enable re-use of workflow configuration across projects. Therefore, in order
to maintain consistency across GOV.UK projects, it is beneficial that we
document and re-use common practices.</p>
<p>This documentation contains examples of a number of common build needs for
GOV.UK projects. You are encouraged to base your project&rsquo;s configuration on
these and to follow their conventions. If your preferences, or common action
conventions, deviate from these examples you are encouraged to open a PR to
this repository to propose a change here. This is preferential to taking a
project in a different direction and losing consistency.</p>
<h2 id='github-action-examples'>GitHub Action Examples</h2><h3 id='simple-ruby-application'>Simple Ruby Application</h3><div class="highlight"><pre class="highlight yaml"><code><span class="c1"># .github/workflows/ci.yml</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">vendor/bundle</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">bundle-${{ hashFiles('**/Gemfile.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="s">bundle</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle install --jobs 4 --retry 3 --deployment</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec rake</span>
</code></pre></div><p>Notes:</p>

<ul>
<li><a href="https://github.com/ruby/setup-ruby">ruby/setup-ruby</a> will automatically
select the Ruby version based on a <code>.ruby-version</code> file and will install
bundler if a necessary.</li>
<li>This use <a href="https://github.com/actions/cache">actions/cache</a> to cache gems
between runs.</li>
<li>This uses the <a href="https://bundler.io/man/bundle-install.1.html#DEPLOYMENT-MODE">deployment</a> flag for bundler to be
configured for CI environments, the jobs flag allows parallel installs and
retries allows re-attempts on failures.</li>
</ul>
<h3 id='a-ruby-gem'>A Ruby Gem</h3><p>This differs to a simple Ruby application as Ruby gems are not tied to a
particular Ruby version, therefore for those we should test a variety of
Ruby versions. Do bear in mind that due to the restriction on secrets
usage we cannot currently publish gems through GitHub Actions, this can
still be achieved through Jenkins.</p>
<div class="highlight"><pre class="highlight yaml"><code><span class="c1"># .github/workflows/ci.yml</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">ruby</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">2.5</span><span class="pi">,</span> <span class="nv">2.6</span><span class="pi">,</span> <span class="nv">2.7</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ruby-version</span><span class="pi">:</span> <span class="s">${{ matrix.ruby }}</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">vendor/bundle</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">bundle-${{ matrix.ruby }}-${{ hashFiles('**/*.gemspec') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="s">bundle-${{ matrix.ruby }}</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle install --jobs 4 --retry 3 --path vendor/bundle</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec rake</span>
</code></pre></div><p>Notes:</p>

<ul>
<li>The <a href="https://bundler.io/man/bundle-install.1.html#DEPLOYMENT-MODE">deployment</a> flag for bundler cannot be used for gems
as they should not have a Gemfile.lock committed.</li>
<li>Our preference is to test the gems we publish against the latest version of
<a href="https://www.ruby-lang.org/en/downloads/branches/">all currently supported minor versions of Ruby MRI</a>.</li>
</ul>
<h2 id='gov-uk-rails-application-with-postgres-redis-yarn-and-gov-uk-content-schemas-dependencies'>GOV.UK Rails application with Postgres, Redis, Yarn and GOV.UK Content Schemas dependencies</h2><p>This is an example that suits a relatively complex GOV.UK Rails application
(this was written for <a href="https://github.com/alphagov/content-publisher">Content Publisher</a>) that has software dependencies
(provided by <a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idservices">Docker containers</a>), cloning of a
supplementary repository, and the use of Node.js for JavaScript dependency
management.</p>
<div class="highlight"><pre class="highlight yaml"><code><span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">services</span><span class="pi">:</span>
      <span class="na">postgres</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:9.4</span>
        <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">5432:5432</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">POSTGRES_HOST_AUTH_METHOD</span><span class="pi">:</span> <span class="s">trust</span>
        <span class="na">options</span><span class="pi">:</span> <span class="s">--health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries </span><span class="m">5</span>
      <span class="na">redis</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
        <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">6379:6379</span>
        <span class="na">options</span><span class="pi">:</span> <span class="s">--health-cmd "redis-cli ping" --health-interval 10s --health-timeout 5s --health-retries </span><span class="m">5</span>
    <span class="na">env</span><span class="pi">:</span>
      <span class="na">RAILS_ENV</span><span class="pi">:</span> <span class="s">test</span>
      <span class="na">REDIS_URL</span><span class="pi">:</span> <span class="s">redis://localhost:6379/0</span>
      <span class="na">TEST_DATABASE_URL</span><span class="pi">:</span> <span class="s">postgresql://postgres@localhost/content-publisher</span>
      <span class="na">GOVUK_CONTENT_SCHEMAS_PATH</span><span class="pi">:</span> <span class="s">vendor/govuk-content-schemas</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Clone project</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Clone GOV.UK Content Schemas</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">repository</span><span class="pi">:</span> <span class="s">alphagov/govuk-content-schemas</span>
          <span class="na">ref</span><span class="pi">:</span> <span class="s">deployed-to-production</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">vendor/govuk-content-schemas</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for cached bundler</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">vendor/bundle</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">bundle-${{ hashFiles('**/Gemfile.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="s">bundle</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle install --jobs 4 --retry 3 --deployment</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v1</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm install -g yarn</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for cached node modules</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">node_modules</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">yarn-${{ hashFiles('**/yarn.lock') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="s">yarn</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">yarn install --frozen-lockfile</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec rails db:setup</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec rails assets:precompile</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec rake</span>
</code></pre></div><p>Notes:</p>

<ul>
<li><a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idservices">Similar service configurations</a> to PostgreSQL and
Redis can be applied to other software dependencies such as MySQL, MongoDB
or Rabbit MQ.</li>
<li>The <code>health-cmd</code> checks are used on services to ensure the build does not
continue until the service is running.</li>
<li>Additional repositories are cloned to the vendor directory for a consistent
location for third party code, this is consistent with Bundler.</li>
<li>Since the same actions are used in different contexts the <code>name</code> option has
been used in steps to distinguish the different steps.</li>
<li>The <code>bundle exec rails assets:precompile</code> task is used to build a warm cache
of assets before starting tests to reduce risk of timeouts, this is due to
an <a href="https://github.com/alphagov/govuk-frontend/issues/1671">underlying performance issue</a> with GOV.UK asset
compilation.</li>
<li>In the underlying project (Content Publisher) <code>bundle exec rake</code> performs:
Ruby &amp; JS unit testing; Ruby, SCSS, JavaScript and FactoryBot linting; and
brakeman security audit.</li>
<li>This example does not include tagging the <a href="https://docs.publishing.service.gov.uk/manual/testing-projects.html#fixing-the-build-number">master branch with a particular
release tag</a> when there is a successful master build.</li>
</ul>


  <div class='related-content'>

    <h3>More in the Testing section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/brakeman.html">Brakeman</a></li>
            <li><a href="/manual/jenkins-ci.html">Jenkins CI infrastructure</a></li>
            <li><a href="/manual/pact-broker.html">Pact Broker</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/test-and-build-a-project-on-jenkins-ci.html">Test & build a project on Jenkins CI</a></li>
            <li><a href="/manual/troubleshooting-jenkins-performance.html">Troubleshoot CI Jenkins Performance</a></li>
            <li><a href="/manual/publishing-e2e-tests.html">Work with the end to end publishing tests</a></li>
          </ul>
        </div>

    </div>
</div>


              <div data-module='page-expiry' data-last-reviewed-on="2020-11-11">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 11 May 2020.

        It needs to be reviewed again on 11 November 2020
        by the page owner <a href="">#govuk-developers</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 11 November 2020
       by the page owner <a href="">#govuk-developers</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/test-and-build-a-project-with-github-actions.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Test%20&amp;%20build%20a%20project%20with%20GitHub%20Actions'&amp;body=Problem%20with%20'Test%20&amp;%20build%20a%20project%20with%20GitHub%20Actions'%20(https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
